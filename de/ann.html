function highlightCurrentSubtitle() { const currentTime = audio.currentTime; let
matchedIndex = -1; for (let i = 0; i < subtitles.length; i++) { const sub =
subtitles[i]; if (currentTime >= sub.start && currentTime <= sub.end) {
matchedIndex = i; break; } if (currentTime >= sub.start) { matchedIndex = i; } }
if (matchedIndex !== currentIndex) { const prev =
document.querySelector('.subtitle.active'); if (prev)
prev.classList.remove('active'); const currentElem =
document.querySelector(`.subtitle[data-index="${matchedIndex}"]`); if
(currentElem) { currentElem.classList.add('active'); // Scroll only if it's not
fully visible if (!isFullyVisible(currentElem)) { scrollWithOffset(currentElem);
} } currentIndex = matchedIndex; } } function isFullyVisible(el) { const rect =
el.getBoundingClientRect(); const headerHeight =
document.getElementById('header').offsetHeight; const viewHeight =
window.innerHeight || document.documentElement.clientHeight; return rect.top >=
headerHeight && rect.bottom <= viewHeight; } function scrollWithOffset(el) {
const headerHeight = document.getElementById('header').offsetHeight; const elTop
= el.getBoundingClientRect().top + window.pageYOffset; window.scrollTo({ top:
elTop - headerHeight, behavior: 'smooth' }); }
